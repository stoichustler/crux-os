Take care, this code is used by both crux and tools ...
